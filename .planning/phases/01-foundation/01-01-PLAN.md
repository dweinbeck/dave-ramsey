---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/envelopes/layout.tsx
  - src/app/envelopes/page.tsx
  - src/app/envelopes/transactions/page.tsx
  - src/app/envelopes/analytics/page.tsx
  - src/components/envelopes/EnvelopesNav.tsx
  - src/components/layout/NavLinks.tsx
autonomous: true

must_haves:
  truths:
    - "User navigates to /envelopes and sees a page rendered inside the existing site shell (Navbar, Footer)"
    - "User navigates to /envelopes/transactions and sees a placeholder page with sub-navigation"
    - "User navigates to /envelopes/analytics and sees a placeholder page with sub-navigation"
    - "Sub-navigation tabs (Home / Transactions / Analytics) are visible on all three pages"
    - "Active tab is highlighted with gold border-bottom; inactive tabs have no border"
    - "Unauthenticated user sees Sign in with Google button instead of envelope content"
    - "Envelopes link appears in main site navigation for authenticated users"
  artifacts:
    - path: "src/app/envelopes/layout.tsx"
      provides: "AuthGuard wrapper + EnvelopesNav for all envelope pages"
      contains: "AuthGuard"
    - path: "src/app/envelopes/page.tsx"
      provides: "Home page placeholder"
      contains: "Digital Envelopes"
    - path: "src/app/envelopes/transactions/page.tsx"
      provides: "Transactions page placeholder"
      contains: "Transactions"
    - path: "src/app/envelopes/analytics/page.tsx"
      provides: "Analytics page placeholder"
      contains: "Analytics"
    - path: "src/components/envelopes/EnvelopesNav.tsx"
      provides: "Sub-navigation tabs with active state"
      contains: "usePathname"
    - path: "src/components/layout/NavLinks.tsx"
      provides: "Main nav with Envelopes link for authenticated users"
      contains: "Envelopes"
  key_links:
    - from: "src/app/envelopes/layout.tsx"
      to: "src/components/envelopes/EnvelopesNav.tsx"
      via: "import and render"
      pattern: "import.*EnvelopesNav"
    - from: "src/app/envelopes/layout.tsx"
      to: "src/components/auth/AuthGuard.tsx"
      via: "import and wrap children"
      pattern: "import.*AuthGuard"
    - from: "src/components/envelopes/EnvelopesNav.tsx"
      to: "next/navigation"
      via: "usePathname for active tab detection"
      pattern: "usePathname"
---

<objective>
Create the routing shell, sub-navigation, and placeholder pages for the Digital Envelopes feature.

Purpose: Users can navigate to all three envelope routes inside the existing site shell with working tab navigation and authentication gating. This is the visible foundation that all subsequent phases render into.

Output: Layout file, three placeholder pages, sub-navigation component, updated main nav.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md

# Key source files to reference for patterns:
@src/app/control-center/layout.tsx
@src/components/admin/ControlCenterNav.tsx
@src/components/auth/AuthGuard.tsx
@src/components/layout/NavLinks.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EnvelopesNav component and envelopes layout with placeholder pages</name>
  <files>
    src/components/envelopes/EnvelopesNav.tsx
    src/app/envelopes/layout.tsx
    src/app/envelopes/page.tsx
    src/app/envelopes/transactions/page.tsx
    src/app/envelopes/analytics/page.tsx
  </files>
  <action>
    Create `src/components/envelopes/EnvelopesNav.tsx` -- a client component modeled exactly on `src/components/admin/ControlCenterNav.tsx`. Differences from ControlCenterNav:
    - `navLinks` array: `[{ name: "Home", href: "/envelopes", exact: true }, { name: "Transactions", href: "/envelopes/transactions", exact: false }, { name: "Analytics", href: "/envelopes/analytics", exact: false }]`
    - `aria-label="Envelopes"` on the `<nav>` element
    - Use the SAME Tailwind classes as ControlCenterNav (border-b, border-gray-200, bg-white, etc.) -- do NOT change the styling to use CSS custom property names like `border-border` or `bg-surface` unless ControlCenterNav already uses them. Match ControlCenterNav exactly.

    Create `src/app/envelopes/layout.tsx` -- a server component modeled on `src/app/control-center/layout.tsx`. Key difference: use `AuthGuard` (not `AdminGuard`) because envelopes is for all authenticated users, not just admin. Import `AuthGuard` from `@/components/auth/AuthGuard` and `EnvelopesNav` from `@/components/envelopes/EnvelopesNav`.

    Create three placeholder pages:
    - `src/app/envelopes/page.tsx`: Title "Digital Envelopes", subtitle "Your weekly envelope budgets will appear here." Use `mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-12` container matching the site's content width pattern.
    - `src/app/envelopes/transactions/page.tsx`: Title "Transactions", subtitle "Your weekly transactions will appear here."
    - `src/app/envelopes/analytics/page.tsx`: Title "Analytics", subtitle "Your spending analytics will appear here."

    All three pages should export `metadata` with appropriate `title` values (e.g., `{ title: "Digital Envelopes" }`, `{ title: "Transactions | Digital Envelopes" }`, `{ title: "Analytics | Digital Envelopes" }`).

    Use `text-2xl font-bold text-primary font-display mb-4` for h1 headings and `text-text-secondary` for subtitles -- these are the existing design system classes.
  </action>
  <verify>
    - `npm run build` succeeds with no TypeScript errors
    - `npm run lint` passes with no errors
    - Manually verify: `EnvelopesNav.tsx` has `"use client"` directive, imports `clsx`, `Link`, `usePathname`
    - Manually verify: `layout.tsx` imports `AuthGuard` (not `AdminGuard`) and `EnvelopesNav`
    - Manually verify: All three page files exist and export `metadata`
  </verify>
  <done>
    All five files exist. Layout wraps children in AuthGuard + EnvelopesNav. Three placeholder pages render with headings and subtitles. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Envelopes link to main site navigation for authenticated users</name>
  <files>
    src/components/layout/NavLinks.tsx
  </files>
  <action>
    Edit `src/components/layout/NavLinks.tsx` to add an "Envelopes" link visible to all authenticated users.

    In the `links` computation (`useMemo`), add logic so that when `user` is truthy (any authenticated user), the "Envelopes" link is included. Currently, `Control Center` is added only when `user?.email === ADMIN_EMAIL`. The new logic should be:

    ```typescript
    const links = useMemo(() => {
      const result = [...baseLinks];
      if (user) {
        result.push({ name: "Envelopes", href: "/envelopes" });
      }
      if (user?.email === ADMIN_EMAIL) {
        result.push({ name: "Control Center", href: "/control-center" });
      }
      return result;
    }, [user]);
    ```

    This ensures:
    - Unauthenticated users see only `baseLinks`
    - Authenticated users see `baseLinks` + "Envelopes"
    - Admin sees `baseLinks` + "Envelopes" + "Control Center"

    The order matters: "Envelopes" appears before "Control Center" in the nav. Do NOT modify any other part of NavLinks.tsx.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm run lint` passes
    - Manually verify: NavLinks.tsx adds "Envelopes" link when `user` is truthy
    - Manually verify: "Control Center" still only appears for admin email
    - Manually verify: No other changes to NavLinks.tsx beyond the `useMemo` block
  </verify>
  <done>
    NavLinks.tsx shows "Envelopes" for all authenticated users and "Control Center" for admin only. Build and lint pass.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` -- no TypeScript errors, all pages compile
2. `npm run lint` -- no Biome errors
3. File existence check: all 5 new files + 1 modified file exist
4. `layout.tsx` uses `AuthGuard` (not `AdminGuard`)
5. `EnvelopesNav.tsx` has correct navLinks with exact: true for Home
6. NavLinks.tsx adds "Envelopes" for authenticated users, preserves admin-only "Control Center"
</verification>

<success_criteria>
- All three routes (`/envelopes`, `/envelopes/transactions`, `/envelopes/analytics`) render placeholder content inside the site shell
- Sub-navigation tabs appear on all envelope pages with correct active state highlighting
- Unauthenticated users see "Sign in with Google" button
- Authenticated users see "Envelopes" in main site navigation
- Build and lint pass with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
