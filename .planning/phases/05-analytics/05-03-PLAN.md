---
phase: 05-analytics
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SummaryStats.tsx
  - /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/WeeklyPivotTable.tsx
  - /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SavingsChart.tsx
  - /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/AnalyticsPage.tsx
  - /Users/dweinbeck/Documents/personal-brand/src/app/envelopes/analytics/page.tsx

autonomous: true

must_haves:
  truths:
    - "Analytics page displays current-week summary stats: total spent, total budget, total remaining, and on-track indicator"
    - "Weekly pivot table shows rows for each week, columns for each envelope, with cell values being sum of transactions per envelope per week"
    - "Savings tracker displays cumulative savings total with a week-over-week growth visualization"
    - "Analytics page shows meaningful empty states when no data exists"
  artifacts:
    - path: "/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SummaryStats.tsx"
      provides: "Four summary stat cards in responsive grid"
      contains: "SummaryStats"
    - path: "/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/WeeklyPivotTable.tsx"
      provides: "Scrollable table with week rows and envelope columns"
      contains: "WeeklyPivotTable"
    - path: "/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SavingsChart.tsx"
      provides: "Recharts AreaChart showing cumulative savings growth"
      contains: "SavingsChart"
    - path: "/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/AnalyticsPage.tsx"
      provides: "Main analytics client component orchestrating all sections"
      contains: "AnalyticsPage"
    - path: "/Users/dweinbeck/Documents/personal-brand/src/app/envelopes/analytics/page.tsx"
      provides: "Server component rendering AnalyticsPage client component"
      contains: "AnalyticsPage"
  key_links:
    - from: "/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/AnalyticsPage.tsx"
      to: "useAnalytics"
      via: "SWR hook provides data to all child components"
      pattern: "useAnalytics"
    - from: "/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SavingsChart.tsx"
      to: "recharts"
      via: "AreaChart, ResponsiveContainer imports"
      pattern: "from.*recharts"
    - from: "/Users/dweinbeck/Documents/personal-brand/src/app/envelopes/analytics/page.tsx"
      to: "AnalyticsPage"
      via: "Server component renders client component"
      pattern: "AnalyticsPage"
---

<objective>
Build the analytics page UI with three sections: summary stats cards, weekly pivot table, and savings growth chart.

Purpose: This is the user-facing analytics page that fulfills ANL-01, ANL-02, and ANL-03. It replaces the existing placeholder page with a fully functional analytics dashboard.

Output: Four new components (SummaryStats, WeeklyPivotTable, SavingsChart, AnalyticsPage) and an updated analytics page.tsx.
</objective>

<execution_context>
@/Users/dweinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dweinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-analytics/05-02-SUMMARY.md

@/Users/dweinbeck/Documents/personal-brand/src/lib/envelopes/types.ts
@/Users/dweinbeck/Documents/personal-brand/src/lib/envelopes/hooks.ts
@/Users/dweinbeck/Documents/personal-brand/src/lib/envelopes/format.ts
@/Users/dweinbeck/Documents/personal-brand/src/components/envelopes/EnvelopesHomePage.tsx
@/Users/dweinbeck/Documents/personal-brand/src/components/ui/Card.tsx
@/Users/dweinbeck/Documents/personal-brand/src/app/envelopes/analytics/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: SummaryStats and WeeklyPivotTable components</name>
  <files>
    /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SummaryStats.tsx
    /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/WeeklyPivotTable.tsx
  </files>
  <action>
**SummaryStats.tsx** — "use client" component displaying four stat cards in a responsive grid.

Props: `{ totalSpentCents: number; totalBudgetCents: number; totalRemainingCents: number; onTrackCount: number; totalEnvelopeCount: number }`

Layout: `grid grid-cols-2 gap-4 sm:grid-cols-4` — 2 columns on mobile, 4 on desktop.

Four cards using the existing `Card` component (import from `@/components/ui/Card`):
1. **Total Spent** — `formatCents(totalSpentCents)` in navy/primary
2. **Total Budget** — `formatCents(totalBudgetCents)` in navy/primary
3. **Remaining** — `formatCents(totalRemainingCents)` in sage (green) if >= 0, red-700 if negative
4. **Status** — "On Track" (sage) if all envelopes on track, otherwise "{onTrackCount}/{totalEnvelopeCount}" (amber)

Use `clsx` for conditional styling (already installed). Use `formatCents` from `@/lib/envelopes/format`.

Style each card: `text-center` with label `text-xs text-text-secondary` and value `text-lg font-semibold font-display`.

**WeeklyPivotTable.tsx** — "use client" component rendering a scrollable table.

Props: `{ envelopes: { id: string; title: string }[]; pivotRows: PivotRow[] }`

Import `PivotRow` from `@/lib/envelopes/types`. Import `formatCents` from `@/lib/envelopes/format`.

If `pivotRows.length === 0`, render a `<p>` with empty state message: "No transaction data yet. Analytics will appear after you record some spending."

Table structure:
- Wrap in `<div className="overflow-x-auto">` for horizontal scrolling on mobile
- `<table className="w-full text-sm">` with proper thead/tbody
- Header row: "Week" | envelope titles (one column per envelope) | "Total"
- Body rows (one per pivotRow): weekLabel | formatCents(cells[envId] ?? 0) for each envelope | formatCents(totalCents)
- Style: `border-b border-border` on rows, `px-3 py-2` on cells
- Header cells: `text-left font-medium text-text-secondary text-xs`
- Data cells: `text-right tabular-nums` for numeric alignment
- Week label cell: `text-left font-medium`
- Total column: `font-semibold`
- Cells with 0 spending: show as dim/muted text (e.g., `text-text-secondary/50` or just show "$0.00" in lighter color)
  </action>
  <verify>`npx tsc --noEmit` passes in personal-brand repo. Both files exist and export their components.</verify>
  <done>SummaryStats renders four stat cards with correct formatting and conditional coloring. WeeklyPivotTable renders a scrollable table with envelope columns and week rows.</done>
</task>

<task type="auto">
  <name>Task 2: SavingsChart + AnalyticsPage + update page.tsx</name>
  <files>
    /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SavingsChart.tsx
    /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/AnalyticsPage.tsx
    /Users/dweinbeck/Documents/personal-brand/src/app/envelopes/analytics/page.tsx
  </files>
  <action>
**SavingsChart.tsx** — "use client" component using Recharts AreaChart.

Props: `{ data: { weekLabel: string; cumulativeCents: number }[] }`

If `data.length === 0`, render empty state: "Savings data will appear after your first complete week."

If data exists, render:
```tsx
import { Area, AreaChart, CartesianGrid, ResponsiveContainer, Tooltip, XAxis, YAxis } from "recharts";
import { formatCents } from "@/lib/envelopes/format";

<ResponsiveContainer width="100%" height={300}>
  <AreaChart data={data}>
    <CartesianGrid strokeDasharray="3 3" stroke="var(--color-border)" />
    <XAxis
      dataKey="weekLabel"
      tick={{ fontSize: 12, fill: "var(--color-text-secondary)" }}
    />
    <YAxis
      tickFormatter={(v) => formatCents(v)}
      tick={{ fontSize: 12, fill: "var(--color-text-secondary)" }}
    />
    <Tooltip
      formatter={(value: number) => [formatCents(value), "Savings"]}
    />
    <Area
      type="monotone"
      dataKey="cumulativeCents"
      stroke="var(--color-sage)"
      fill="var(--color-sage)"
      fillOpacity={0.15}
      strokeWidth={2}
    />
  </AreaChart>
</ResponsiveContainer>
```

Use the project's CSS custom properties for colors: `--color-sage` for the savings area fill/stroke, `--color-border` for grid lines, `--color-text-secondary` for axis labels.

IMPORTANT: Check if the CSS custom properties use the `--color-` prefix or not. Look at the existing components (EnvelopeCard, StatusBadge) to see how they reference design tokens. Match the same pattern. If the project uses Tailwind v4 with `@theme` references (e.g., `text-sage` maps to the sage color), the CSS variables might be `--color-sage` or just `--sage`. Inspect `globals.css` to confirm the exact variable names for the chart styling.

If Recharts CSS variable references fail (because Tailwind v4 manages them differently), use the literal hex values from the design system: sage=#6b8e6f, border color from existing Card component, text-secondary from existing component patterns.

**AnalyticsPage.tsx** — "use client" orchestrator component.

Import `useAnalytics` from `@/lib/envelopes/hooks`.
Import `SummaryStats`, `WeeklyPivotTable`, `SavingsChart`.

Structure:
```tsx
export function AnalyticsPage() {
  const { data, error, isLoading } = useAnalytics();

  if (isLoading) return <div className="text-center py-12 text-text-secondary">Loading analytics...</div>;
  if (error) return <div className="text-center py-12 text-red-700">Failed to load analytics.</div>;
  if (!data) return null;

  return (
    <div className="space-y-8">
      <section>
        <h2 className="text-lg font-semibold font-display text-primary mb-4">This Week</h2>
        <SummaryStats {...data.summary} />
      </section>

      <section>
        <h2 className="text-lg font-semibold font-display text-primary mb-4">Weekly Spending</h2>
        <WeeklyPivotTable envelopes={data.envelopes} pivotRows={data.pivotRows} />
      </section>

      <section>
        <h2 className="text-lg font-semibold font-display text-primary mb-4">Savings Growth</h2>
        <SavingsChart data={data.savingsByWeek} />
      </section>
    </div>
  );
}
```

Match the existing styling patterns from EnvelopesHomePage (same heading styles, spacing, loading states).

**Update page.tsx** — Replace the existing placeholder content.

The existing analytics page.tsx is a placeholder (from Phase 1). Replace its content with:

```tsx
import { AnalyticsPage } from "@/components/envelopes/AnalyticsPage";

export default function AnalyticsRoute() {
  return <AnalyticsPage />;
}
```

This follows the same server-component-wraps-client-component pattern used by the envelopes home page and transactions page.
  </action>
  <verify>
`npm run build` passes in personal-brand repo (full build, not just type check).
`ls /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/SavingsChart.tsx` confirms file exists.
`ls /Users/dweinbeck/Documents/personal-brand/src/components/envelopes/AnalyticsPage.tsx` confirms file exists.
`grep "AnalyticsPage" /Users/dweinbeck/Documents/personal-brand/src/app/envelopes/analytics/page.tsx` confirms wiring.
  </verify>
  <done>
Analytics page renders three sections: summary stats cards, weekly pivot table, and savings growth chart.
Page uses useAnalytics() hook to fetch data.
Empty states displayed when no data exists.
Recharts AreaChart renders savings growth with project design tokens.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes in personal-brand repo
2. `npm run lint` passes (Biome v2.3)
3. All four new component files exist in `src/components/envelopes/`
4. Analytics page.tsx imports and renders AnalyticsPage component
5. No `console.log` or `debugger` statements in new files
6. No hardcoded colors -- uses design system tokens (CSS variables or Tailwind classes)
7. Empty states render when data arrays are empty
</verification>

<success_criteria>
- Analytics page displays summary stats in a 4-card responsive grid (ANL-01)
- Weekly pivot table shows weeks as rows and envelopes as columns with transaction sums (ANL-02)
- Savings chart shows cumulative savings growth as an area chart (ANL-03)
- Loading and error states handled gracefully
- Empty states shown when no historical data exists
- Styling matches existing site design (navy/gold/sage theme, Card component, font-display)
</success_criteria>

<output>
After completion, create `.planning/phases/05-analytics/05-03-SUMMARY.md`
</output>
